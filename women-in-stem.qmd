---
title: "Practicality of Using Transformations in MLR"
author: "Lydia Gibson"
format: 
  revealjs:
    theme: [default, style.scss]
    footer: Cal State East Bay STAT 694 Final Presentation
---

# Introduction
```{r echo=FALSE, warning=FALSE, message=FALSE}
dat1 <- read.csv("women-stem.csv")

library(pacman)

suppressWarnings(p_load(dplyr, ggplot2, ggpubr, scales, MASS, car, lmtest, 
                        ggrepel, faraway, ggcorrplot, GGally, lindia, see, performance, ggstatsplot, rstantools, PMCMRplus, cowplot, parameters, report, datawizard))

options(scipen = 100) # remove scientific notation
```

- In [previous research](https://github.com/lgibson7/Gender-Wage-Inequality-in-STEM), I used **multiple linear regression (MLR)** to explore the relationship between median salary of STEM major categories and gender demographics. 
- The final reduced model used the inverse transformation of the response variable to improve the model fit.
- While transforming response and/or explanatory variables can lead to a better fitting model, often it is not easily understood by the average person. 

# Outline

Problem

Data Source

Background

Methods

Results

Conclusion

Further Research

# Problem

How much prediction power is lost by ***not*** using a transformed response variable in a multiple linear regression model?

# Data Source
- The [data](https://github.com/fivethirtyeight/data/blob/master/college-majors/women-stem.csv) was obtained from the American Community Survey (ACS) 2010-2012 Public Use Microdata Series (PUMS). 
- It has 76 observations, each representing a STEM major, and 9 variables: `Rank`, `Major_code`, `Major`, `Major_category`, `Total`, `Men`, `Women`, `ShareWomen`, `Median`. 


# Background

## 
```{r echo=FALSE, warning=FALSE, message=FALSE}

# remove Rank, Major_code, and Major
dat2 <- dat1[,-c(1,2,3)] 

# Get totals for men and women for each major category
dat_stats <- rbind(
  
#   Get totals for men
  dat2 %>% group_by(Major_category) %>%
    summarize(Grand_Total = sum(Men), Proportion=Grand_Total/sum(Total)) %>%
    mutate(Sex="Men", labelpos=Proportion/2),
  
# Get totals for women
dat2 %>% group_by(Major_category) %>%
 summarize(Grand_Total = sum(Women), Proportion=Grand_Total/sum(Total)) %>%
 mutate(Sex="Women", labelpos=1 - (Proportion/2))) %>% 
mutate(Sex = Sex %>% factor(levels=c("Men", "Women")))

# bar chart
p7 <- dat_stats %>% ggplot(aes(x=Major_category, y=Proportion, fill=Sex)) +
  stat_summary(geom = "bar", position="fill") +
 ggtitle("Proportion of Sexes across Major Categories") +
  scale_y_continuous(labels = scales::percent_format()) + 
  labs(x="Major Category", y="Proportion of Sexes") +
  scale_x_discrete(labels = scales::label_wrap(15)) +
  scale_fill_manual(values = c( "#F1F1F1", "#FCA3B5")
                    )

p7 <- p7 + theme(legend.position = "top")
p7


```

## 
```{r}
# violin plot
p8 <- ggstatsplot::ggbetweenstats(
  data  = dat1,
  x     = Major_category,
  y     = Median,
  xlab = "Major Category",
  ylab = " Median Salary($)",
  type = "robust",
  p.adjust.method = "bonferroni",
  results.subtitle = FALSE,
  title = "Median Salary across Major Categories",
  outlier.tagging = TRUE,
  outlier.label = Major,
  package = "ggsci",
  palette = "default_jco"
  
  )

p8
```

# Method

- In this project, I will compare multiple linear regression models **with** an inverse transformation dependent response variable to one **without** an inverse transformation dependent response variable.


```{r echo=FALSE}
## need to do step-wise reduction from full additive model

options(scipen=3)

#datawizard::standardize(dat2)

lm_full <- lm(Median~.,data=dat2)

lm_reduced <- lm((Median^(-1)) ~ Major_category + Men + ShareWomen + Men*ShareWomen,
                 data=dat2)


```

## Model *Without* Transformed Variable
```{r, size= "tiny"}
parameters::model_parameters(lm_full)
```

# Why Do a Transformation?
```{r echo=FALSE, warning=FALSE, message=FALSE}

p1 <- ggpubr::gghistogram(dat2$Median) + ggtitle("Response Variable Without Transformation")

p2 <-lindia::gg_boxcox(lm_full) + ggtitle("Box Cox for Model Without Transformation")

plot_grid(p1, p2)
```

## Model *With* Transformed Variable
```{r, size="tiny"}
parameters::model_parameters(lm_reduced)

```


## Comparison of Models

*Comparison*


## Diagnostic Plots for Model *Without* Transformations
```{r}
#lindia::gg_diagnose(lm_full)
performance::check_model(lm_full)
```

## Diagnostic Plots for Model *With* Transformations
```{r}
#lindia::gg_diagnose(lm_reduced)
performance::check_model(lm_reduced)
```

# Results

## Metrics Comparison
```{r}
performance::compare_performance(lm_reduced, lm_full, metrics = "common")
```

## Model Prediction
```{r eval=FALSE}
# need to figure why lm_reduced won't output

#report::report(lm_reduced)
#report::report(lm_full)
```

*statistical output*

# Conclusion

- The practical implications of using an inverse transformation dependent response variable in multiple linear regression are.....
- Upon reviewing the adjusted $R^2$ values of each model, it appears that..... 
- Bullet point 3


# Further Research

-   I would like to use the ACS Application Programming Interface (API) to export more recent data and run the multiple linear regression models using the [TidyModels](https://github.com/tidymodels) framework.
-   I would like to compare the base R statistical data visualizations to those from the various ggplot2 extension packages ([`ggpubr`](https://github.com/kassambara/ggpubr), [`easystats`](https://github.com/easystats), [`lindia`](https://github.com/yeukyul/lindia), [`ggstatsplot`](https://github.com/IndrajeetPatil/ggstatsplot)) used in this presentation.


# Acknowledgements

- I would like to thank my colleagues, Sara Hatter and Ken Vu, with whom I collaborated on the previous research project [*Gender Wage Inequality in STEM*](https://github.com/lgibson7/Gender-Wage-Inequality-in-STEM).
- I would like to thank the FiveThirtyEight blog for uploading the data behind their story, [*The Economic Guide To Picking A College Major*](https://fivethirtyeight.com/features/the-economic-guide-to-picking-a-college-major/), which was used for this analysis.
- I would like to thank Prof. Eric Suess for his assistance with this research.


# Appendix

- This presentation can be viewed at: <https://lgibson7.quarto.pub/women-in-stem>. 
- Code for this presentation can be found at: <https://github.com/lgibson7/Women-in-STEM>.